# Developer documentation

A list of guidelines about the contribution to WebCord's source code. Please
note this file is large for a reason it is meant to document almost everything
you need to know to start developing WebCord.

<div align="center">

| üößÔ∏è **Warning:** This file is being rewritten and it is still incomplete! |
| --- |

</div>

## Table of contents

- [Source tree](#source-tree)
    - [Top-level directories and configuration files](#top-level-directories-and-configuration-files)
    - [Directories and files inside the sources folder](#directories-and-files-inside-the-sources-folder)
    - [Source files containing WebCord's code](#source-files-containing-webcords-code)
- [Working with the sources](#working-with-the-sources)
- [Code style accepted on WebCord](#code-style-accepted-on-webcord)

## Source tree
WebCord contains many sources and assets for each of its features ‚Äì this may
lead to the confusion to the developers, who don't know where they should
place their code and where to find the part for the specific feature.

### Top-level directories and configuration files

WebCord's local repositories usually has the following top-level folders:

- `sources` ‚Äì this is the most important part of the WebCord's repository, as
   it contains all the source code files and assets (including transcompiled
   code to JavaScript).

- `docs` ‚Äì this is where this documentation is placed. It may contain the
   subfolders with the translations of the documentation to different languages.
   Please note as this folder contains the official documentation files, **PRs**
   **with community-made traslations won't be pulled to the WebCord's remote**
   **repository** ‚Äì instead, you may show your interest at maintaining the
   community documentation by starting / joining a new thread at GitHub
   discussions with the proposition to allow for the Wikis (they're currently
   disabled).

- `node_modules` ‚Äì this is the folder generated by NPM to store WebCord's
   dependencies. It shouldn't be pushed to the remote repository, but if it is
   there for some reason, please create a new issue as quickly as it is
   possible.

- `out` ‚Äì this is the folder containing the packaged version of the WebCord and
  its *distributables* (i.e `*.deb` for Debian, `*.rpm` for Fedora, `*.AppImage`
  for Linux in general and `*.zip` for Windows and MacOS).

Moreover, you may find these top-level files at your copy of WebCord's
repository as well:

- `package.json` ‚Äì this file contains the imporant metadata used by `npm` and
  `electron` like the WebCord's dependencies, path to `main` script, path to
  forge configuration or even that *WebCord is WebCord*.

- `package-lock.json` ‚Äì a file generated by `npm` and is used to lock
  dependencies to the various versions. As WebCord's release model in master
  tends to always use as much up-to-date dependency versions as it is possible,
  most dependencies aren't locked and

- `yarn.lock` ‚Äì a lock file similar to `package-lock.json`, except it is used by
  the `yarn` package manager.

- `tsconfig.json` ‚Äì a JSON with Comments configuration file that contains the
  metadata.

- `.eslintrc.json` ‚Äì a linter configuration (ESLint).

### Directories and files inside the `sources` folder

To make code browsing much easier, the code and assets are grouped by their type
in following folders:

- `code` ‚Äì contains the code of the application in TypeScript format. As WebCord
  code is quite large nowadays, the code is seperated into different files in
  following folders:

  - `main` ‚Äì has the part of the code that is WebCord-specific and cannot be
     reused by the any other software without code modifications.

  - `internalModules` ‚Äì includes the scripts that are made in such way they can
     be reused by different software without any code modifications. In the
     future, I will host them on the Node.js registry to allow others using them
     in their own software as modules.

  - `forge` ‚Äì an Electron Forge specific files; as of now, it contains
     only the configuration files.

- `assets` ‚Äì contains all assets being part of the WebCord as a software. Assets
  in this folder are grouped in the following subfolders:
  
  - `icons` ‚Äì contains all icons used by WebCord (including app icon and tray
   icons).

  - `translations` ‚Äì a directory that includes official translations made to
    WebCord.

  - `web` ‚Äì a folder for HTML internal webpages used by WebCord.

- `app` ‚Äì includes transcompiled application code to JavaScript language, with
  comments removed to save some space. I don't recommend messing with that files
  as they're overwritten by `tsc` anyway, unless you want to find if TypeScript
  did messed anything during the compilation (which is rather not going to
  happen, at least with the stable features). It has the same structure as
  `code` folder.

### Source files containing WebCord's code

Since initial release, WebCord has drastically changed that it's code became
too large for developing it comfortably in single file. This also needed the
naming scheme. So, in general, WebCord's source code files are named and put in
the folders under following name scheme:
```
{file-group}/[sub-group]/{file-function}.ts
```
In more detailed description, the following files has the roles described below:

1. Main process scripts (`main/`):

  - `main/mainScript.ts` ‚Äì the function that is responsible for loading another
    functions from the other files; it's currently includes some window
    implementations, like *main* and *about* window declarations, althrought it
    is planned to move these declarations into separate files.

  - `main/nativeMenus.ts` ‚Äì includes modules that declares various (OS-native)
    menus, as well as some functions implementing various features called via
    it.

  - `main/configManager.ts` ‚Äì contains classes and types used for reading and
    modifying various configuration files in WebCord.

  - `main/addonsLoader.ts` ‚Äì provides a support for the addons within WebCord, including
    Chromium extensions support and non-standard Node.js WebCord extension
    format definition.

  - `main/l10nSupport.ts` ‚Äì definies the localization support within WebCord.

  - `main/cspTweaker.ts` ‚Äì definies the Content Security Policy information,
    that will be used by WebCord to overwrite the original CSP headers, allowing
    to block some third-party websites not being neccessary for Discord to work.
    
  - `main/clientProperties.ts` ‚Äì contains some globablly-used properties within
    WebCord's main process. It contains some metadata not available in
    `package.json`, like the URL to Discord website.

  - `main/updateNotifier.ts` ‚Äì a module used to implement the updates
    notification functionality in WebCord.

2. Windows declarations (`main/windows/`):
  - `main/windows/aboutPanel.ts` ‚Äì declares the OS native application's *about*
    panel, that displays some information like application's version or the
    contributors' list.

  - `main/windows/docsViewer.ts` ‚Äì definies the WebCord's documentation browser,
    using the [`marked`](https://www.npmjs.com/package/marked) engine for the
    markdown rendering.

  - `main/windows/mainWindow.ts` ‚Äì contains the declaration of WebCord's main
    window, i.e. a such window that shows up first when running it.

  - `main/windows/settingsWindow.ts` ‚Äì a window definition used for WebCord's
    new HTML-based configuration panel.

3. Internal modules (`internalModules/`):

  - `internalModules/userAgent.ts` ‚Äì a module that fakes the WebCord's user agent,
    by generating it using Chromium engine version in current Electron release.

  - `internalModules/bugReporter.ts` ‚Äì a module which generates an URL to the new
    GitHub issue, which is an URL to a `bug` template pre-filled with some OS
    details that are available to the Electron. Current (as of WebCord ) implementation
    
  - `internalModules/jsoncParser.ts` ‚Äì contains the definition for WebCord's
    minimalist JSONC parser implementation, used for JSONC support in
    client translation files.

  - `internalModules/errorHandler.ts` ‚Äì handles `uncaughtException`s, allowing
    for prettier output in some cases as well as `dialog` GUI window displaying
    error message and simplified error stack.

4. Renderer process scripts:

  - `renderer/capturer.ts` ‚Äì contains the implementation of the `desktopCapturer`
    interface, used for implementing a screen share support for Discord.

  - `renderer/cosmetic.ts` ‚Äì does some cosmetic changes to Discord website,
    making it to look more like a real Discord client.

5. Window-specific `preload` scripts:

  - `renderer/preload/mainWindow.ts` ‚Äì a preload script for `mainWindow`,
     basically loads `capturer.ts` and `cosmetic.ts` scripts described in
     the previous section.

  - `renderer/preload/settings.ts` ‚Äì a front-end script for the WebCord's
    settings manager; it communicates via the IPC to load and fetch the
    configuration from the website.

  - `renderer/preload/docs.ts` ‚Äì a script providing the functionality for
    WebCord's markdown documentation reader.

6. Build configuration (i.e. for Electron Forge):

  - `buildConfig/forge.ts` ‚Äì contains app's Electron Forge configurations.
  
  - `buildConfig/forge.d.ts` ‚Äì includes types definitions for the Electron
    Forge configuration.

7. `global.ts` ‚Äì has simple modules declarations used between multiple processes
   (i.e. both main and renderer process scripts).

## Working with the sources

<div align="center">

| üößÔ∏è **Part under construction!** |
| --- |

</div>

## Code style accepted on WebCord

<div align="center">

| üößÔ∏è **Part under construction!** |
| --- |

</div>