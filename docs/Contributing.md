# Developer documentation

A list of guidelines about the contribution to WebCord's source code. Please
note this file is large for a reason it is meant to document almost everything
you need to know to start developing WebCord.

<div align="center">

| üößÔ∏è **Warning:** This file is being rewritten and it is still incomplete! |
| --- |

</div>

## Table of contents

  - [Source tree](#source-tree)
      - [Top-level directories and configuration files](#top-level-directories-and-configuration-files)
      - [Directories and files inside the sources folder](#directories-and-files-inside-the-sources-folder)
      - [Source files containing WebCord's code](#source-files-containing-webcords-code)
  - [Working with the sources](#working-with-the-sources)
      - [Install app dependencies.](#install-app-dependencies)
      - [Compile code and run app directly without packaging.](#compile-code-and-run-app-directly-without-packaging)
      - [Run linter and validate the code.](#run-linter-and-validate-the-code)
      - [Packaging / creating distributables.](#packaging--creating-distributables)
  - [Code style accepted on WebCord](#code-style-accepted-on-webcord)

## Source tree
WebCord contains many sources and assets for each of its features ‚Äì this may
lead to the confusion to the developers, who don't know where they should
place their code and where to find the part for the specific feature.

### Top-level directories and configuration files

WebCord's local repositories usually has the following top-level folders:

- `sources` ‚Äì this is the most important part of the WebCord's repository, as
   it contains all the source code files and assets (including transcompiled
   code to JavaScript).

- `docs` ‚Äì this is where this documentation is placed. It may contain the
   subfolders with the translations of the documentation to different languages.
   Please note as this folder contains the official documentation files, **PRs**
   **with community-made traslations won't be pulled to the WebCord's remote**
   **repository** ‚Äì instead, you may show your interest at maintaining the
   community documentation by starting / joining a new thread at GitHub
   discussions with the proposition to allow for the Wikis (they're currently
   disabled).

- `node_modules` ‚Äì this is the folder generated by NPM to store WebCord's
   dependencies. It shouldn't be pushed to the remote repository, but if it is
   there for some reason, please create a new issue as quickly as it is
   possible.

- `out` ‚Äì this is the folder containing the packaged version of the WebCord and
  its *distributables* (i.e `*.deb` for Debian, `*.rpm` for Fedora, `*.AppImage`
  for Linux in general and `*.zip` for Windows and MacOS).

Moreover, you may find these top-level files at your copy of WebCord's
repository as well:

- `package.json` ‚Äì this file contains the imporant metadata used by `npm` and
  `electron` like the WebCord's dependencies, path to `main` script, path to
  forge configuration or even that *WebCord is WebCord*.

- `package-lock.json` ‚Äì a file generated by `npm` and is used to lock
  dependencies to the various versions. As WebCord's release model in master
  tends to always use as much up-to-date dependency versions as it is possible,
  most dependencies aren't locked and there's no lock file published into the
  repository for that reason (see `.gitignore` if you want to change that).

- `yarn.lock` ‚Äì a lock file similar to `package-lock.json`, except it is used by
  the `yarn` package manager.

- `tsconfig.json` ‚Äì a JSON with Comments configuration file that contains the
  metadata.

- `.eslintrc.json` ‚Äì a linter configuration (ESLint).

### Directories and files inside the `sources` folder

To make code browsing much easier, the code and assets are grouped by their type
in following folders:

- `code` ‚Äì contains the code of the application in TypeScript format. As WebCord
  code is quite large nowadays, the code is seperated into different files in
  following folders:

  - `main` ‚Äì has the part of the code that is WebCord-specific and cannot be
     reused by the any other software without code modifications.

  - `modules` ‚Äì includes the scripts that are made in such way they can
     be reused by different software without any code modifications. In the
     future, I will host them on the Node.js registry to allow others using them
     in their own software as modules.

  - `build` ‚Äì folder that includes scripts associated with the build
    configuration; currently it is used for the Electron Forge only (`forge.ts`).

- `assets` ‚Äì contains all assets being part of the WebCord as a software. Assets
  in this folder are grouped in the following subfolders:
  
  - `icons` ‚Äì contains all icons used by WebCord (including app icon and tray
    icons).

  - `translations` ‚Äì a directory that includes official translations made to
    WebCord.

  - `web` ‚Äì a folder for HTML internal webpages used by WebCord.

- `app` ‚Äì includes transcompiled application code to JavaScript language, with
  comments removed to save some space. I don't recommend messing with that files
  as they're overwritten by `tsc` anyway, unless you want to find if TypeScript
  did messed anything during the compilation (which is rather not going to
  happen, at least with the stable features). It has the same structure as
  `code` folder.

### Source files containing WebCord's code

Since initial release, WebCord has drastically changed that it's code became
too large for developing it comfortably in single file. This also needed the
naming scheme. So, in general, WebCord's source code files are named and put in
the folders under following name scheme:
```
{file-group}/[sub-group]/{file-function}.ts
```
In more detailed description, the following files has the roles described below:

1. `main/main.ts` ‚Äì a script that is responsible for loading another
   functions from the other files; it's currently includes some window
   implementations, like *main* and *about* window declarations, althrought it
   is planned to move these declarations into separate files.

2. Main process modules (`main/`):

  - `main/menus.ts` ‚Äì includes modules that declares various (OS-native)
    menus, as well as some functions implementing various features called via
    it.

  - `main/config.ts` ‚Äì contains classes and types used for reading and
    modifying various configuration files in WebCord.

  - `main/addons.ts` ‚Äì provides a support for the addons within WebCord, including
    Chromium extensions support and non-standard Node.js WebCord extension
    format definition.

  - `main/csp.ts` ‚Äì definies the Content Security Policy information,
    that will be used by WebCord to overwrite the original CSP headers, allowing
    to block some third-party websites not being neccessary for Discord to work.
    
  - `main/client.ts` ‚Äì contains some globablly-used properties within
    WebCord's main process. It contains some metadata not available in
    `package.json`, like the URL to Discord website.

  - `main/update.ts` ‚Äì a module used to implement the updates
    notification functionality in WebCord.

3. Application windows declarations (`main/windows/`):

  - `main/windows/about.ts` ‚Äì declares the OS native application's *about*
    panel, that displays some information like application's version or the
    contributors' list.

  - `main/windows/docs.ts` ‚Äì definies the WebCord's documentation browser,
    using the [`marked`](https://www.npmjs.com/package/marked) engine for the
    markdown rendering.

  - `main/windows/main.ts` ‚Äì contains the declaration of WebCord's main
    window, i.e. a such window that shows up first when running it.

  - `main/windows/settings.ts` ‚Äì a window definition used for WebCord's
    new HTML-based configuration panel.

4. Internal modules (`modules/`):

  - `modules/user.ts` ‚Äì a module that fakes the WebCord's user agent,
    by generating it using Chromium engine version in current Electron release.

  - `modules/bug.ts` ‚Äì a module which generates an URL to the new
    GitHub issue, which is an URL to a `bug` template pre-filled with some OS
    details that are available to the Electron. Current (as of WebCord ) implementation

  - `modules/error.ts` ‚Äì handles `uncaughtException`s, allowing
    for prettier output in some cases as well as `dialog` GUI window displaying
    error message and simplified error stack.

  - `modules/l10n.ts` ‚Äì definies the localization support within WebCord.

5. Renderer process modules (`renderer/modules`):

  - `renderer/modules/capturer.ts` ‚Äì contains the implementation of the `desktopCapturer`
    interface, used for implementing a screen share support for Discord.

  - `renderer/modules/cosmetic.ts` ‚Äì does some cosmetic changes to Discord website,
    making it to look more like a real Discord client.

6. Window-specific `preload` scripts:

  - `renderer/preload/mainWindow.ts` ‚Äì a preload script for `mainWindow`,
     basically loads `capturer.ts` and `cosmetic.ts` scripts described in
     the previous section.

  - `renderer/preload/settings.ts` ‚Äì a front-end script for the WebCord's
    settings manager; it communicates via the IPC to load and fetch the
    configuration from the website.

  - `renderer/preload/docs.ts` ‚Äì a script providing the functionality for
    WebCord's markdown documentation reader.

7. Build configuration (i.e. for Electron Forge):

  - `build/forge.ts` ‚Äì contains app's Electron Forge configurations.
  
  - `build/forge.d.ts` ‚Äì includes types definitions for the Electron
    Forge configuration.

8. `global.ts` ‚Äì has simple modules declarations used between multiple processes
   (i.e. both main and renderer process scripts).

## Working with the sources

When working with the WebCord, there're many tools you may have to use to be able
to compile it from TypeScript to JavaScript, package it to the distributable
format, run linter and so on. This section will describe the commands you may
need to know to proceed with its developement or packaging it yourself from
its source code.

**Note:** To simplify the documentation, only `npm` command syntax is shown
below. If you preffer using `yarn`, you're free to do so as WebCord does not
depend on any specific Node.js package manager.

### Install app dependencies.

This is the first command you need to execute ‚Äì without that, you won't be able
to proceed with the app testing and run most of the commands listed in
`package.json`.
```sh
npm install # or npm i
```

To update the dependencies after you have installed them:
```
npm update
```

Be aware that `npm i` will also install the developement dependencies. **This is**
**what you probably want**, as those dependencies includes all of the recommended
packages required for compiling, linting and packaging WebCord. If you however
want to install the production dependencies only (i.e. you want to use your own
set of the tools or have installed them globally with `npm i -g`), you can use
the following command instead:
```
npm i --only=prod
```

### Compile code and run app directly (without packaging).

After you have installed all required `dependencies` and `devDependencies`, you
can use the following command to incrementally transcompile WebCord's source
code from TypeScript to JavaScript:
```
npm run build
```

To both compile code and start application even before it is packaged:
```
npm start
```

### Run linter and validate the code.

While developing, you may want to check if your code quality is enough to be
accepted as part of the WebCord project. To do that, you may want to both compile
it (to ensure there're no compiler errors) and run linter (to check for the other
issues). To do this, you can use the command below:
```
npm test
```

You can also run linter only if you don't want to compile the code:
```
npm run linter
```

### Packaging / creating distributables.

If you want to share with someone the binaries of your packaged application, or
just install and/or use it without the source code and developement packages,
you can generate all distributable files that are valid for your platform using
following command:
```
npm run make
```

You can also create a directory containing a packaged app. This directory isn't
adapted for a specific distributable format, but it contains the Electron binary
with the compiled application, which needs to be set up manually if you want to
install it within your OS. To package an application without `make`-ing it,
execute the following command:
```
npm run package
```

This will package the app for your current platform.

## Code style accepted on WebCord

<div align="center">

| üößÔ∏è **Part under construction!** |
| --- |

</div>